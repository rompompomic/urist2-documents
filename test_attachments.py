"""
Тестирование функции format_attachments с реальными именами файлов
"""

from pathlib import Path
from processor import DocumentProcessor
import os

# Список файлов для теста
test_files = [
    "1. Доверенность представителя;.pdf",
    "10. Сведения о доходах за 2021-2024 г.;.pdf",
    "11. Сведения о трудовой деятельности;.pdf",
    "12. Сведения о состоянии индивидуального лицевого счета застрахованного лица;.pdf",
    "13. Справка о счетах;.pdf",
    "14. Выписка из Единого государственного реестра недвижимости о правах отдельного лица на имевшиеся (имеющиеся) у него объекты недвижимости;.pdf",
    "15. Справка СФР о назначенных пенсиях и социальных выплатах;.pdf",
    "16. Справка СФР о назначенных выплатах за период;.pdf",
    "17. Отчет АО ОКБ;.pdf",
    "18. Отчет АО БКИ Скоринг-бюро;.pdf",
    "19. Справка ГИБДД;.pdf",
    "20. Налоговое уведомление;.pdf",
    "21. Справка о прохождении военной службы по контракту;.pdf",
    "22. Договор купли-продажи транспортного средства от 28.03.2024 г.;.pdf",
    "23. Сведения из ЕГРН;.pdf",
    "24. Справка о задолженности перед ООО МКК КНОПКАДЕНЬГИ;.pdf",
    "25. Справка о задолженности перед ООО МКК СМЭВ;.pdf",
    "26. Выписка ЕГРИП;.pdf",
    "27. Справка о наличии (отсутствии) судимости;.PDF",
    "28. Доверенность в порядке передоверия..pdf",
    "6. Почтовые квитанции, подтверждающие направление заявления кредиторам;.pdf",
    "7. Копия паспорта должника;.pdf",
    "8. Копия ИНН должника;.pdf",
    "9. Копия СНИЛС должника;.pdf",
]

# Создаем Path объекты
pdf_paths = [Path(f) for f in test_files]

print("=" * 80)
print("ТЕСТ ФУНКЦИИ format_attachments")
print("=" * 80)

# Получаем OpenAI клиент
try:
    from openai import OpenAI
    api_key = os.getenv("OPENAI_API_KEY")
    if not api_key:
        print("\nWARNING: OPENAI_API_KEY не найден в переменных окружения")
        print("Будет использоваться fallback без GPT\n")
        client = None
    else:
        client = OpenAI(api_key=api_key)
        print("\nOpenAI клиент инициализирован\n")
except Exception as e:
    print(f"\nWARNING: Не удалось инициализировать OpenAI: {e}")
    print("Будет использоваться fallback без GPT\n")
    client = None

# Вызываем функцию
print("Форматирование списка приложений...\n")
result = DocumentProcessor.format_attachments(pdf_paths, client)

print("=" * 80)
print("РЕЗУЛЬТАТ:")
print("=" * 80)
print(result)
print("=" * 80)

# Подсчитываем количество строк
lines = result.split('\n')
print(f"\nВсего документов в списке: {len(lines)}")
print(f"Из них обязательных (фиксированных): 5")
print(f"Загруженных документов: {len(test_files)}")
